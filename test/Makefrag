
CC:=g++

TEST_SOURCES:=$(wildcard test/*test.cpp)
TESTS:=$(TEST_SOURCES:test/%.cpp=%)

test: $(TESTS:%=run-%)

run-%: $(GEN_DIR)/test/%
	@echo "TEST	$(@:run-%=%)"
	-@sudo $(GEN_DIR)/test/$(@:run-%=%)

$(GEN_DIR)/test/%: $(GEN_DIR)/test/%.o $(GEN_DIR)/test/test_utilities.o $(GEN_DIR)/libdogears.a 
	@echo 'LD	$@ $^'
	@$(CC) $(LFLAGS) -o $@ $^ -Lbin -ldogears

$(GEN_DIR)/test/%.o: test/%.cpp $(wildcard test/test_utilities.*)
	@mkdir -p $(GEN_DIR)/test
	@echo 'G++	$<'
	@$(CC) $(CFLAGS) -o $@ $<
